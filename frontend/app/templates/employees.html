{% extends "layout.html" %}

{% block title %}リソース管理{% endblock %}

{% block content %}
<div class="flex justify-between items-center mb-6">
    <h2 class="text-2xl font-bold text-gray-700">稼働状況ヒートマップ (6ヶ月)</h2>
    <form action="/employees" method="get" class="flex space-x-2">
        <input type="text" name="q" value="{{ request.query_params.get('q', '') }}" 
               placeholder="氏名、スキル、業界で検索..." 
               class="shadow border rounded py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline w-64">
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
            検索
        </button>
        {% if request.query_params.get('q') %}
        <a href="/employees" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">クリア</a>
        {% endif %}
    </form>
</div>

<div class="bg-white shadow-md rounded my-6 overflow-x-auto">
    <table class="min-w-full table-auto border-collapse">
        <thead>
            <tr class="bg-gray-200 text-gray-600 uppercase text-sm leading-normal">
                <th class="py-3 px-6 text-left sticky left-0 bg-gray-200 z-10">社員名</th>
                <th class="py-3 px-6 text-left">役職 & スキル</th>
                {% for header in month_headers %}
                <th class="py-3 px-2 text-center min-w-[80px]">{{ header }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody class="text-gray-600 text-sm font-light">
            {% for emp in employees %}
            <tr class="border-b border-gray-200 hover:bg-gray-100">
                <td class="py-3 px-6 text-left sticky left-0 bg-white z-10 font-medium whitespace-nowrap align-top">
                    {{ emp.name }}
                    <div class="text-xs text-gray-400 font-normal">{{ emp.email }}</div>
                </td>
                <td class="py-3 px-6 text-left align-top">
                    <div class="font-bold mb-1">{{ emp.role }}</div>
                    <div class="flex flex-wrap gap-1 mb-1">
                        {% for skill in emp.skills.split(',') %}
                        {% if skill %}
                        <span class="bg-blue-100 text-blue-800 text-xs px-2 py-0.5 rounded">{{ skill }}</span>
                        {% endif %}
                        {% endfor %}
                    </div>
                    <div class="flex flex-wrap gap-1">
                        {% for ind in emp.industries.split(',') %}
                        {% if ind %}
                        <span class="bg-gray-100 text-gray-800 text-xs px-2 py-0.5 rounded border border-gray-300">{{ ind }}</span>
                        {% endif %}
                        {% endfor %}
                    </div>
                </td>
                {% for month in emp.heatmap %}
                <td class="py-3 px-2 text-center border-l border-gray-100 align-middle">
                    {% if month.percent == 0 %}
                        <div class="bg-red-100 text-red-600 py-1 rounded w-full font-bold">0%</div>
                    {% elif month.percent < 80 %}
                        <div class="bg-yellow-100 text-yellow-600 py-1 rounded w-full font-bold">{{ month.percent }}%</div>
                    {% elif month.percent <= 100 %}
                        <div class="bg-green-100 text-green-600 py-1 rounded w-full font-bold">{{ month.percent }}%</div>
                    {% else %}
                        <div class="bg-purple-100 text-purple-600 py-1 rounded w-full font-bold">{{ month.percent }}%</div>
                    {% endif %}
                </td>
                {% endfor %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
